<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>镜像仓库管理台</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="background" aria-hidden="true">
      <div class="orb orb-a"></div>
      <div class="orb orb-b"></div>
      <div class="mesh"></div>
    </div>

    <div class="app">
      <header class="header panel">
        <div>
          <p class="kicker">Docker Registry v2</p>
          <h1>私有镜像仓库管理台</h1>
        </div>
        <div class="status-wrap" aria-live="polite">
          <span class="status-dot" id="healthDot"></span>
          <span id="healthText">正在检查仓库状态...</span>
        </div>
      </header>

      <main class="layout">
        <section class="panel repository-panel" aria-label="仓库管理">
          <div class="section-head panel-title-row">
            <h2>仓库列表</h2>
            <button id="refreshReposBtn" class="ghost-btn" aria-label="刷新仓库列表">刷新</button>
          </div>

          <div class="section-block">
            <label class="input-label" for="repoSearch">搜索</label>
            <input id="repoSearch" class="text-input" placeholder="输入仓库名..." />
          </div>

          <div class="section-block">
            <div class="local-actions">
              <button id="selectAllRemoteBtn" class="ghost-btn" aria-label="全选可见仓库">全选可见仓库</button>
              <button id="clearRemoteBtn" class="ghost-btn" aria-label="清空仓库选择">清空仓库选择</button>
            </div>
          </div>

          <div class="section-block">
            <label class="input-label" for="remotePrefixMode">远程重命名前缀模式</label>
            <select id="remotePrefixMode" class="text-input">
              <option value="add">批量添加前缀</option>
              <option value="remove">批量移除前缀</option>
            </select>
            <label class="input-label" for="remotePrefixValue">远程前缀值</label>
            <input id="remotePrefixValue" class="text-input" placeholder="例如：x86 或 arm 或 prod/x86" />
            <label class="toggle-item">
              <input id="cleanupRemoteSourceTag" type="checkbox" />
              <span>重命名成功后删除旧仓库标签</span>
            </label>
          </div>

          <div class="section-block action-group">
            <button id="runRemotePrefixBtn" class="primary-btn wide">一键远程重命名</button>
          </div>
          <div class="danger-zone">
            <button id="runRemoteDeleteBtn" class="danger-btn wide">一键删除已选仓库</button>
          </div>

          <div class="section-block">
            <p id="remoteHint" class="meta-line" aria-live="polite">已选仓库：0</p>
            <ul id="repoList" class="repo-list" aria-label="远程仓库列表"></ul>
            <button id="loadMoreBtn" class="ghost-btn wide">加载更多</button>
          </div>
        </section>

        <div class="middle-stack">
          <section class="panel task-terminal-panel" aria-label="当前任务终端">
            <div class="panel-title-row">
              <h2>当前任务终端</h2>
              <span id="jobStatusChip" class="chip" aria-live="polite">空闲</span>
            </div>
            <pre id="jobLogBox" class="log-box prominent-log" aria-live="polite">暂无运行中的任务。</pre>
          </section>

          <section class="panel tags-panel" aria-label="标签管理">
            <div class="section-head panel-title-row">
              <h2 id="repoTitle">请选择一个仓库</h2>
              <button id="refreshTagsBtn" class="ghost-btn" aria-label="刷新当前仓库标签">刷新标签</button>
            </div>
            <p id="repoMeta" class="meta-line" aria-live="polite">尚未选择仓库。</p>

            <div class="table-wrap">
              <table aria-label="仓库标签列表">
                <thead>
                  <tr>
                    <th>标签</th>
                    <th>摘要</th>
                    <th>大小</th>
                    <th>创建时间</th>
                    <th class="th-action">操作</th>
                  </tr>
                </thead>
                <tbody id="tagTableBody"></tbody>
              </table>
            </div>
          </section>
        </div>

        <aside class="panel sync-panel" aria-label="同步与任务">
          <div class="section-head">
            <h2>远程镜像同步</h2>
            <p class="meta-line">
              从外部仓库拉取镜像，然后推送到你的私有仓库。
            </p>
          </div>

          <div class="section-block">
            <form id="syncForm" class="sync-form">
              <label class="input-label" for="sourceImage">源镜像</label>
              <input id="sourceImage" class="text-input" placeholder="例如：nginx:1.27" required />

              <label class="input-label" for="targetRepo">目标仓库（可选）</label>
              <input id="targetRepo" class="text-input" placeholder="例如：platform/nginx" />

              <label class="input-label" for="targetTag">目标标签（可选）</label>
              <input id="targetTag" class="text-input" placeholder="例如：stable" />

              <label class="toggle-item">
                <input id="cleanupMirrorLocalImages" type="checkbox" checked />
                <span>同步完成后清理本地镜像标签</span>
              </label>

              <button id="syncBtn" class="primary-btn" type="submit">开始同步</button>
            </form>
          </div>

          <div class="job-panel">
            <div class="panel-title-row">
              <h3>本地镜像批量上传</h3>
              <button id="refreshLocalBtn" class="ghost-btn" aria-label="扫描本地镜像">扫描本地镜像</button>
            </div>
            <p class="meta-line" id="localHint">
              选择本地镜像，设置架构后缀和前缀策略，一键上传。
            </p>

            <div class="local-controls">
              <label class="input-label" for="archMode">架构处理模式</label>
              <select id="archMode" class="text-input">
                <option value="auto">自动识别主机架构</option>
                <option value="custom">自定义</option>
                <option value="none">不追加架构后缀</option>
              </select>

              <label class="input-label" for="archValue">自定义架构值（仅自定义模式）</label>
              <input id="archValue" class="text-input" placeholder="例如：x86 或 arm" />

              <label class="input-label" for="prefixMode">前缀处理模式</label>
              <select id="prefixMode" class="text-input">
                <option value="none">不修改前缀</option>
                <option value="add">批量添加前缀</option>
                <option value="remove">批量移除前缀</option>
              </select>

              <label class="input-label" for="prefixValue">前缀值</label>
              <input id="prefixValue" class="text-input" placeholder="例如：x86、arm、prod/x86" />
            </div>

            <div class="local-actions">
              <button id="selectAllLocalBtn" class="ghost-btn">全选</button>
              <button id="clearLocalBtn" class="ghost-btn">清空选择</button>
              <button id="pushLocalBtn" class="primary-btn">上传已选镜像</button>
              <button id="deleteLocalBtn" class="danger-btn">删除已选镜像</button>
            </div>
            <div class="toggle-grid">
              <label class="toggle-item">
                <input id="cleanupLocalTag" type="checkbox" />
                <span>上传成功后删除本地旧标签</span>
              </label>
              <label class="toggle-item">
                <input id="cleanupRegistrySourceTag" type="checkbox" />
                <span>上传成功后删除仓库旧标签</span>
              </label>
            </div>
            <ul id="localImageList" class="local-list"></ul>
          </div>

          <div class="job-panel">
            <div class="panel-title-row">
              <h3>最近任务</h3>
              <button id="refreshJobsBtn" class="ghost-btn" aria-label="刷新最近任务">刷新</button>
            </div>
            <ul id="jobList" class="job-list" aria-label="最近任务列表"></ul>
          </div>
        </aside>
      </main>
    </div>

    <script type="module" src="/static/app.js"></script>
  </body>
</html>
